CREATE TABLE Users (
    id INT PRIMARY KEY IDENTITY,
    name NVARCHAR(100) NOT NULL,
    email NVARCHAR(100) UNIQUE NOT NULL,
    phone NVARCHAR(20),
    password NVARCHAR(255) NOT NULL,
    role INT NOT NULL,  -- 1: Admin, 0: User
    status BIT DEFAULT 0  -- Default value 0 represents FALSE (not banned)
);

CREATE TABLE WeeklyMenus (
    id INT PRIMARY KEY IDENTITY,
    name NVARCHAR(100) NOT NULL,
    description NVARCHAR(MAX),
    diet_type INT NOT NULL,  -- 0: Vegetarian, 1: Vegan, 2: Regular, 3: Special
    created_at DATETIME2 DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME2 DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE Recipes (
    id INT PRIMARY KEY IDENTITY,
    name NVARCHAR(100) NOT NULL,
    description NVARCHAR(MAX),
    ingredients_id NVARCHAR(MAX),
    instructions NVARCHAR(MAX),
    weekly_menu_id INT,
    FOREIGN KEY (weekly_menu_id) REFERENCES WeeklyMenus(id)
);

CREATE TABLE PersonalMealPlans (
    id INT PRIMARY KEY IDENTITY,
    user_id INT,
    name NVARCHAR(100) NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    created_at DATETIME2 DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME2 DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(id)
);

CREATE TABLE MealPlanItems (
    id INT PRIMARY KEY IDENTITY,
    meal_plan_id INT,
    recipe_id INT,
    day_of_week INT NOT NULL,  -- 0: Monday, 1: Tuesday, 2: Wednesday, 3: Thursday, 4: Friday, 5: Saturday
    created_at DATETIME2 DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME2 DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (meal_plan_id) REFERENCES PersonalMealPlans(id),
    FOREIGN KEY (recipe_id) REFERENCES Recipes(id)
);

CREATE TABLE Orders (
    id INT PRIMARY KEY IDENTITY,
    user_id INT,
    address NVARCHAR(MAX) NOT NULL,
    total_price DECIMAL(10, 2) NOT NULL,
    status INT NOT NULL,  -- 0: Pending, 1: Confirmed, 2: Delivered, 3: Cancelled
    created_at DATETIME2 DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME2 DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(id)
);

CREATE TABLE OrderItems (
    id INT PRIMARY KEY IDENTITY,
    order_id INT,
    recipe_id INT,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES Orders(id),
    FOREIGN KEY (recipe_id) REFERENCES Recipes(id)
);

CREATE TABLE OrderHistory (
    id INT PRIMARY KEY IDENTITY,
    order_id INT,
    status INT NOT NULL,  -- 0: Pending, 1: Confirmed, 2: Delivered, 3: Cancelled
    changed_at DATETIME2 DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES Orders(id)
);

create table Ingredients(
    id	                INT PRIMARY KEY IDENTITY,
    [name]		NVARCHAR(255)	NOT NULL,
    unit		NVARCHAR(50),
    price		MONEY,
    total_quantity	INT,
    category		NVARCHAR(100),
    [description]	TEXT,
    [status]		BIT
);

CREATE TABLE Ingredient_Images (
    id				INT 		PRIMARY KEY IDENTITY,
    ingredient_id	INT ,
    [image]			IMAGE,
	FOREIGN KEY (ingredient_id) REFERENCES Ingredients(id)
);
create table Meal_Img(
	id int primary key identity,
	meal_id INT,
	[image] image,
	FOREIGN KEY(meal_id) references MealPlanItems(id)
);

CREATE TABLE Recipe_Ingredients (
    recipe_id					INT NOT NULL,
    ingredient_id				INT NOT NULL,
    ingredient_quantity			INT,
    PRIMARY KEY (recipe_id, ingredient_id),
    FOREIGN KEY (recipe_id)		REFERENCES Recipes(id),
    FOREIGN KEY (ingredient_id) REFERENCES Ingredients(id)
);